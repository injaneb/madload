'use strict';document.addEventListener('DOMContentLoaded',()=>{const t={fadeIn:(t,e=.1,r=!0)=>{let i;function a(){i=+t.style.opacity,(i+=e)<=1?(t.style.opacity=i,window.requestAnimationFrame&&requestAnimationFrame(a)||setTimeout(a,16)):1!=+t.style.opacity&&(t.style.opacity=1)}return e>=1&&(e=+('.'+e)),r&&t.hasAttribute('hidden')&&t.removeAttribute('hidden'),t.style.opacity=0,window.requestAnimationFrame&&requestAnimationFrame(a)||setTimeout(a,16),!0},fadeOut:(t,e=.1,r=!0)=>{let i;function a(){i=+t.style.opacity,(i-=e)>=0?(t.style.opacity=i,window.requestAnimationFrame&&requestAnimationFrame(a)||setTimeout(a,16)):(0!=+t.style.opacity&&(t.style.opacity=0),r&&!t.hasAttribute('hidden')&&t.setAttribute('hidden',''))}return e>=1&&(e=+('.'+e)),t.style.opacity=1,window.requestAnimationFrame&&requestAnimationFrame(a)||setTimeout(a,16),!0}};function e(t){if(!t)return!1;let e=t.match(/^(http[s]?:\/\/){0,1}(www\.){0,1}[a-zA-Z0-9.-]+\.[a-zA-Z]{2,5}[.]{0,1}/i);return!!(e&&e.length>0&&['youtube.com','youtu.be','soundcloud.com','twitter.com','facebook.com','instagram.com'].includes(e[0].replace(/(http[s]?:\/\/)|(www\.)/gi,'')))}let r=!1,i=document.getElementById('url'),a=i.nextElementSibling,n=document.getElementById('clipPaste'),d=document.getElementById('clrInput'),o=document.getElementById('output');function u(t,e=!1){a.hasAttribute('disabled')&&a.removeAttribute('disabled'),i.value!==t&&(i.value=t),location.hash!==t&&(location.hash=t),e&&a.click()}if(!i.getAttribute('data-placeholder')&&i.setAttribute('data-placeholder',i.getAttribute('placeholder')),i.addEventListener('focus',()=>{i.setAttribute('placeholder',''),i.value.trim()&&i.select&&i.select()}),i.addEventListener('blur',()=>i.setAttribute('placeholder',i.getAttribute('data-placeholder'))),i.addEventListener('dblclick',()=>{if(i){if(!navigator.clipboard||!navigator.clipboard.writeText){let t=document.createElement('input');return t.value=i.value,t.style.display='none',document.body.appendChild(t),t.focus(),t.select(),document.execCommand('copy'),void document.body.removeChild(t)}navigator.permissions.query({name:'clipboard-write'}).then(t=>{'granted'!==t.state&&'prompt'!==t.state||navigator.clipboard.writeText(i.value)})}}),i.addEventListener('input',()=>{const r=i.value.trim();if(!r)return!a.hasAttribute('disabled')&&a.setAttribute('disabled',''),!d.hasAttribute('hidden')&&t.fadeOut(d),void(!n.hasAttribute('not-supported')&&n.hasAttribute('hidden')&&t.fadeIn(n));!n.hasAttribute('hidden')&&t.fadeOut(n),d.hasAttribute('hidden')&&t.fadeIn(d),e(r)&&u(r,!0)}),location.hash){const r=location.hash.trim().substr(1);!i.value.trim()&&e(r)&&(!n.hasAttribute('hidden')&&t.fadeOut(n),d.hasAttribute('hidden')&&t.fadeIn(d),u(r))}navigator.clipboard&&navigator.clipboard.readText?(!i.value.trim()&&n.hasAttribute('hidden')&&n.removeAttribute('hidden'),n.hasAttribute('not-supported')&&n.removeAttribute('not-supported')):(!n.hasAttribute('hidden')&&n.setAttribute('hidden',''),!n.hasAttribute('not-supported')&&n.setAttribute('not-supported','')),n.addEventListener('click',()=>{if(n.hasAttribute('not-supported'))return!n.hasAttribute('hidden')&&n.setAttribute('hidden','');navigator.permissions.query({name:'clipboard-read'}).then(r=>{'granted'!==r.state&&'prompt'!==r.state||navigator.clipboard.readText().then(r=>{const a=r.trim();a&&(i.value=a,e(a)&&u(a,!0),t.fadeOut(n),setTimeout(()=>d.hasAttribute('hidden')&&t.fadeIn(d)&&n.hasAttribute('style')&&n.removeAttribute('style'),100))})})}),d.addEventListener('click',()=>{i.value='',!a.hasAttribute('disabled')&&a.setAttribute('disabled',''),d.style.transform='rotate(-90deg)',setTimeout(()=>t.fadeOut(d),500),setTimeout(()=>!n.hasAttribute('not-supported')&&n.hasAttribute('hidden')&&t.fadeIn(n)&&d.hasAttribute('style')&&d.removeAttribute('style'),600)}),window.addEventListener('hashchange',()=>{});let s=o.querySelector('.video-card'),l=s.querySelector('.thumbnail'),c=s.querySelector('.info'),h=s.querySelector('.download'),m=l.querySelector('img'),b=c.querySelector('.title a'),A=c.querySelector('.author a'),p=h.querySelector('.formats-list'),f=h.querySelector('.drop-icon'),y=h.querySelector('.get'),v=o.querySelector('.loading'),g=o.querySelector('.errbox'),E=g.querySelector('.err-msg');function q(t,e,r){let i=document.createElement('li');i.setAttribute('data-url',t.url),i.setAttribute('data-ext',t.ext),i.setAttribute('data-filename',e.replace(/\|\\\/\*\+<>:\?"'/g,'_')),t.format&&i.setAttribute('title',t.format),i.textContent=t.ext.toUpperCase(),'m4a'===t.ext||'mp3'===t.ext?i.textContent+=' (audio)':t.formatNote?i.textContent+=` (${t.formatNote})`:t.format&&(i.textContent+=` (${t.format})`),'none'===t.acodec&&i.classList.add('no-audio'),r&&r(i),p.appendChild(i)}function C(e,i=!0){if(!e)return!1;v.hasAttribute('hidden')&&s.hasAttribute('hidden')?g.hasAttribute('hidden')&&t.fadeIn(g):(!v.hasAttribute('hidden')&&t.fadeOut(v),!s.hasAttribute('hidden')&&t.fadeOut(g),setTimeout(()=>t.fadeIn(g),300)),i&&(r=!1),E.textContent=e}p.addEventListener('click',()=>{if(p.childElementCount&&1!==p.childElementCount)return p.hasAttribute('data-list-open')?p.removeAttribute('data-list-open'):void p.setAttribute('data-list-open','')}),document.addEventListener('click',t=>{p.hasAttribute('data-list-open')&&p!==t.target.parentElement&&f!==t.target.parentElement&&p.removeAttribute('data-list-open')}),y.addEventListener('click',()=>{let t=p.firstElementChild,e=document.createElement('a');e.style.display='none',e.setAttribute('download',t.getAttribute('data-filename')),e.setAttribute('href',t.getAttribute('data-url')),document.body.appendChild(e),e.click(),document.body.removeChild(e)}),a.addEventListener('click',()=>{const n=i.value.trim();if(!r){if(!n||!e(n))return!a.hasAttribute('disabled')&&a.setAttribute('disabled',''),C('Please insert a valid url.');r=!0,a.hasAttribute('disabled')&&a.removeAttribute('disabled'),o.hasAttribute('hidden')&&o.removeAttribute('hidden'),s.hasAttribute('hidden')&&g.hasAttribute('hidden')?t.fadeIn(v):(t.fadeOut(s),t.fadeOut(g),setTimeout(()=>t.fadeIn(v),300)),fetch('/api',{method:'post',headers:{Accept:'application/json','Content-Type':'application/json'},body:JSON.stringify({url:n})}).then(t=>{if(t.ok&&t.status>=200&&t.status<300&&'OK'===t.statusText)return t.json();throw'server request error, check your connection and try again.'}).then(e=>{if(!e||!e.ok)return C(e&&e.err||'error occurred when getting info.');for(e.duration&&(l.querySelector('.duration').textContent=e.duration),b.setAttribute('href',e.url),b.textContent=e.title,A.setAttribute('href',e.author.url),A.textContent=e.author.name;p.firstElementChild;)p.removeChild(p.firstElementChild);e.formats?e.formats.length>1?(f.hasAttribute('hidden')&&f.removeAttribute('hidden'),e.formats.forEach(t=>{q(t,`${e.title}.${t.ext}`,t=>{t.addEventListener('click',()=>{t!==p.firstElementChild&&p.firstElementChild.insertAdjacentElement('beforebegin',t)})})})):(!f.hasAttribute('hidden')&&f.setAttribute('hidden',''),q(e.formats[0],`${e.title}.${e.formats[0].ext}`)):C('connot get media data.'),m.setAttribute('src',e.thumbnail),v.hasAttribute('hidden')?t.fadeIn(s):(t.fadeOut(v),setTimeout(()=>t.fadeIn(s),300)),r=!1}).catch(t=>{C('request error occurred.'),console.error(t)})}})});