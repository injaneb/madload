'use strict';document.addEventListener('DOMContentLoaded',()=>{const t={fadeIn:(t,e=.1,i=!0)=>{let r;function a(){r=+t.style.opacity,(r+=e)<=1?(t.style.opacity=r,window.requestAnimationFrame&&requestAnimationFrame(a)||setTimeout(a,16)):1!=+t.style.opacity&&(t.style.opacity=1)}return e>=1&&(e=+('.'+e)),i&&t.hasAttribute('hidden')&&t.removeAttribute('hidden'),t.style.opacity=0,window.requestAnimationFrame&&requestAnimationFrame(a)||setTimeout(a,16),!0},fadeOut:(t,e=.1,i=!0)=>{let r;function a(){r=+t.style.opacity,(r-=e)>=0?(t.style.opacity=r,window.requestAnimationFrame&&requestAnimationFrame(a)||setTimeout(a,16)):(0!=+t.style.opacity&&(t.style.opacity=0),i&&!t.hasAttribute('hidden')&&t.setAttribute('hidden',''))}return e>=1&&(e=+('.'+e)),t.style.opacity=1,window.requestAnimationFrame&&requestAnimationFrame(a)||setTimeout(a,16),!0}};function e(t){if(!t)return!1;let e=t.match(/^(http[s]?:\/\/){0,1}(www\.){0,1}[a-zA-Z0-9.-]+\.[a-zA-Z]{2,5}[.]{0,1}/i);return!!(e&&e.length>0&&['youtube.com','youtu.be','soundcloud.com','twitter.com','facebook.com','instagram.com'].includes(e[0].replace(/(http[s]?:\/\/)|(www\.)/gi,'')))}let i=!1,r=document.getElementById('url'),a=r.nextElementSibling,n=document.getElementById('clipPaste'),d=document.getElementById('clrInput'),o=document.getElementById('output');function u(t,e=!1){a.hasAttribute('disabled')&&a.removeAttribute('disabled'),r.value!==t&&(r.value=t),location.hash!==t&&(location.hash=t),e&&a.click()}if(!r.getAttribute('data-placeholder')&&r.setAttribute('data-placeholder',r.getAttribute('placeholder')),r.addEventListener('focus',()=>{r.setAttribute('placeholder',''),r.value.trim()&&r.select&&r.select()}),r.addEventListener('blur',()=>r.setAttribute('placeholder',r.getAttribute('data-placeholder'))),r.addEventListener('dblclick',()=>{if(r){if(!navigator.clipboard||!navigator.clipboard.writeText){let t=document.createElement('input');return t.value=r.value,t.style.display='none',document.body.appendChild(t),t.focus(),t.select(),document.execCommand('copy'),void document.body.removeChild(t)}navigator.permissions.query({name:'clipboard-write'}).then(t=>{'granted'!==t.state&&'prompt'!==t.state||navigator.clipboard.writeText(r.value)})}}),r.addEventListener('input',()=>{const i=r.value.trim();if(!i)return!a.hasAttribute('disabled')&&a.setAttribute('disabled',''),!d.hasAttribute('hidden')&&t.fadeOut(d),void(!n.hasAttribute('not-supported')&&n.hasAttribute('hidden')&&t.fadeIn(n));!n.hasAttribute('hidden')&&t.fadeOut(n),d.hasAttribute('hidden')&&t.fadeIn(d),e(i)&&u(i,!0)}),location.hash){const i=location.hash.trim().substr(1);!r.value.trim()&&e(i)&&(!n.hasAttribute('hidden')&&t.fadeOut(n),d.hasAttribute('hidden')&&t.fadeIn(d),u(i))}navigator.clipboard&&navigator.clipboard.readText?(!r.value.trim()&&n.hasAttribute('hidden')&&n.removeAttribute('hidden'),n.hasAttribute('not-supported')&&n.removeAttribute('not-supported')):(!n.hasAttribute('hidden')&&n.setAttribute('hidden',''),!n.hasAttribute('not-supported')&&n.setAttribute('not-supported','')),n.addEventListener('click',()=>{if(n.hasAttribute('not-supported'))return!n.hasAttribute('hidden')&&n.setAttribute('hidden','');navigator.permissions.query({name:'clipboard-read'}).then(i=>{'granted'!==i.state&&'prompt'!==i.state||navigator.clipboard.readText().then(i=>{const a=i.trim();a&&(r.value=a,e(a)&&u(a,!0),t.fadeOut(n),setTimeout(()=>d.hasAttribute('hidden')&&t.fadeIn(d)&&n.hasAttribute('style')&&n.removeAttribute('style'),100))})})}),d.addEventListener('click',()=>{r.value='',!a.hasAttribute('disabled')&&a.setAttribute('disabled',''),d.style.transform='rotate(-90deg)',setTimeout(()=>t.fadeOut(d),500),setTimeout(()=>!n.hasAttribute('not-supported')&&n.hasAttribute('hidden')&&t.fadeIn(n)&&d.hasAttribute('style')&&d.removeAttribute('style'),600)}),window.addEventListener('hashchange',()=>{});let s=o.querySelector('.video-card'),l=s.querySelector('.thumbnail'),c=s.querySelector('.info'),h=s.querySelector('.download'),m=l.querySelector('img'),b=l.querySelector('.duration'),A=c.querySelector('.title a'),p=c.querySelector('.author a'),f=h.querySelector('.formats-list'),y=h.querySelector('.drop-icon'),v=h.querySelector('.get'),g=o.querySelector('.loading'),E=o.querySelector('.errbox'),q=E.querySelector('.err-msg');function C(t,e,i){let r=document.createElement('li');r.setAttribute('data-url',t.url),r.setAttribute('data-ext',t.ext),r.setAttribute('data-filename',e.replace(/\|\\\/\*\+<>:\?"'/g,'_')),t.format&&r.setAttribute('title',t.format),r.textContent=t.ext.toUpperCase(),'m4a'===t.ext||'mp3'===t.ext?r.textContent+=' (audio)':t.formatNote?r.textContent+=` (${t.formatNote})`:t.format&&(r.textContent+=` (${t.format})`),'none'===t.acodec&&r.classList.add('no-audio'),i&&i(r),f.appendChild(r)}function w(e,r=!0){if(!e)return!1;g.hasAttribute('hidden')&&s.hasAttribute('hidden')?E.hasAttribute('hidden')&&t.fadeIn(E):(!g.hasAttribute('hidden')&&t.fadeOut(g),!s.hasAttribute('hidden')&&t.fadeOut(E),setTimeout(()=>t.fadeIn(E),300)),r&&(i=!1),q.textContent=e}f.addEventListener('click',()=>{if(f.childElementCount&&1!==f.childElementCount)return f.hasAttribute('data-list-open')?f.removeAttribute('data-list-open'):void f.setAttribute('data-list-open','')}),document.addEventListener('click',t=>{f.hasAttribute('data-list-open')&&f!==t.target.parentElement&&y!==t.target.parentElement&&f.removeAttribute('data-list-open')}),v.addEventListener('click',()=>{let t=f.firstElementChild,e=document.createElement('a');e.style.display='none',e.setAttribute('download',t.getAttribute('data-filename')),e.setAttribute('href',t.getAttribute('data-url')),e.setAttribute('target','_blank'),document.body.appendChild(e),e.click(),document.body.removeChild(e)}),a.addEventListener('click',()=>{const n=r.value.trim();if(!i){if(!n||!e(n))return!a.hasAttribute('disabled')&&a.setAttribute('disabled',''),w('Please insert a valid url.');i=!0,a.hasAttribute('disabled')&&a.removeAttribute('disabled'),o.hasAttribute('hidden')&&o.removeAttribute('hidden'),s.hasAttribute('hidden')&&E.hasAttribute('hidden')?t.fadeIn(g):(t.fadeOut(s),t.fadeOut(E),setTimeout(()=>t.fadeIn(g),300)),fetch('/api',{method:'post',headers:{Accept:'application/json','Content-Type':'application/json'},body:JSON.stringify({url:n})}).then(t=>{if(t.ok&&t.status>=200&&t.status<300&&'OK'===t.statusText)return t.json();throw'server request error, check your connection and try again.'}).then(e=>{if(!e||!e.ok)return w(e&&e.err||'error occurred when getting info.');for(e.duration?(b.textContent=e.duration,b.hasAttribute('hidden')&&b.removeAttribute('hidden')):(b.textContent='',!b.hasAttribute('hidden')&&b.setAttribute('hidden','')),A.setAttribute('href',e.url),A.textContent=e.title,p.setAttribute('href',e.author.url),p.textContent=e.author.name;f.firstElementChild;)f.removeChild(f.firstElementChild);e.formats?e.formats.length>1?(y.hasAttribute('hidden')&&y.removeAttribute('hidden'),e.formats.forEach(t=>{C(t,`${e.title}.${t.ext}`,t=>{t.addEventListener('click',()=>{t!==f.firstElementChild&&f.firstElementChild.insertAdjacentElement('beforebegin',t)})})})):(!y.hasAttribute('hidden')&&y.setAttribute('hidden',''),C(e.formats[0],`${e.title}.${e.formats[0].ext}`)):w('connot get media data.'),m.setAttribute('src',e.thumbnail),g.hasAttribute('hidden')?t.fadeIn(s):(t.fadeOut(g),setTimeout(()=>t.fadeIn(s),300)),i=!1}).catch(t=>{w('request error occurred.'),console.error(t)})}})});